var express=require("express"),path=require("path"),favicon=require("serve-favicon"),logger=require("morgan"),cookieParser=require("cookie-parser"),bodyParser=require("body-parser"),index=require("./routes/index"),users=require("./routes/users"),app=express();app.set("views",path.join(__dirname,"views"));app.set("view engine","jade");app.use(logger("dev"));app.use(bodyParser.json());app.use(bodyParser.urlencoded({extended:!1}));app.use(cookieParser());
app.use(express["static"](path.join(__dirname,"public")));app.use("/",index);app.use("/users",users);app.use(function(a,c,b){a=Error("Not Found");a.status=404;b(a)});app.use(function(a,c,b,d){b.locals.message=a.message;b.locals.error="development"===c.app.get("env")?a:{};b.status(a.status||500);b.render("error")});app.post("/webhook",function(a,c){var b=a.body;"page"===b.object?(b.entry.forEach(function(a){console.log(a.messaging[0])}),c.status(200).send("EVENT_RECEIVED")):c.sendStatus(404)});
app.get("/webhook",function(a,c){var b=a.query["hub.mode"],d=a.query["hub.verify_token"],e=a.query["hub.challenge"];b&&d&&("subscribe"===b&&"P0nt3r1k0s0!"===d?(console.log("WEBHOOK_VERIFIED"),c.status(200).send(e)):c.sendStatus(403))});module.exports=app;
