<!DOCTYPE html>
<html>
  <head>

      <title>Test Vista Web</title>

    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">

  </head>
  <body>
    <div id="content">

        <h1>Hola vista web</h1>
        <span id="psid">psid</span>
    </div>
    <script>

       window.extAsyncInit = function() {

         let message = {
              "attachment":{
                "type":"template",
                "payload":{
                  "template_type":"generic",
                  "elements": [{
                    "title":"I took Peter's 'Which Hat Are You?' Quiz",
                    "image_url": "https://bot.peters-hats.com/img/hats/fez.jpg",
                    "subtitle": "My result: Fez",
                    "default_action":{
                      "type":"web_url",
                      "url": "https://bot.peters-hats.com/view_quiz_results.php?user=24601"
                    },
                    "buttons":[{
                      "type":"web_url",
                      "url":"https://bot.peters-hats.com/hatquiz.php?referer=24601",
                      "title":"Take the Quiz"
                    }]
                  }]
                }
              }
            };

            MessengerExtensions.beginShareFlow(function(share_response) {
              // User dismissed without error, but did they share the message?
              if(share_response.is_sent){
                // The user actually did share.
                // Perhaps close the window w/ requestCloseBrowser().
              }
            },
            function(errorCode, errorMessage) {
            // An error occurred in the process

            },
            message,
            "broadcast");

         MessengerExtensions.getSupportedFeatures(function success(result) {
              let features = result.supported_features;
              if (features.indexOf("context") != -1) {
                MessengerExtensions.getContext('2106254336275881',
                  function success(thread_context) {
                    document.getElementById("psid").innerHTML = thread_context.psid;
                  },
                  function error(err) {
                    console.log(err);
                  }
                );
              }
            }, function error(err) {
              console.log(err);
            });

       };

       (function(doc, script, domId){
         var js, fjs = doc.getElementsByTagName(script)[0];
         if (doc.getElementById(domId)) { return; }
         js = doc.createElement(script);
         js.id = domId;
         js.src = "//connect.facebook.com/en_US/messenger.Extensions.js";
         fjs.parentNode.insertBefore(js, fjs);
       }(document, 'script', 'Messenger'));

    </script>
  </body>
</html>
