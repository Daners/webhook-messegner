<!DOCTYPE html>
<html>
  <head>

      <title>Test Vista Web</title>

    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">

  </head>
  <body>
    <div id="content">

        <h1>Hola vista web</h1>
        <span id="psid">psid</span>
        <button type="button" name="button" onclick="shareFlow()">Send</button>
    </div>
    <script>


function shareFlow(){
  var message = {
    "attachment":{
       "type":"template",
       "payload":{
         "template_type":"generic",
         "elements":[
            {
             "title":"Welcome!",
             "image_url":"https://petersfancybrownhats.com/company_image.png",
             "subtitle":"We have the right hat for everyone.",
             "default_action": {
               "type": "web_url",
               "url": "https://petersfancybrownhats.com/view?item=103",
               "messenger_extensions": false,
               "webview_height_ratio": "tall",
               "fallback_url": "https://petersfancybrownhats.com/"
             },
             "buttons":[
               {
                 "type":"web_url",
                 "url":"https://petersfancybrownhats.com",
                 "title":"View Website"
               },{
                 "type":"postback",
                 "title":"Start Chatting",
                 "payload":"DEVELOPER_DEFINED_PAYLOAD"
               }
             ]
           }
         ]
       }
     }
  }
  MessengerExtensions.beginShareFlow(function(share_response) {
    if(share_response.is_sent){
      window.MessengerExtensions.requestCloseBrowser(null, null);
    }
  },
  function(errorCode, errorMessage) {
    console.log(errorMessage);
  },
  message,
  "broadcast");
}

       window.extAsyncInit = function() {





         MessengerExtensions.getSupportedFeatures(function success(result) {
              let features = result.supported_features;
              if (features.indexOf("context") != -1) {
                MessengerExtensions.getContext('2106254336275881',
                  function success(thread_context) {
                    document.getElementById("psid").innerHTML = thread_context.psid;
                  },
                  function error(err) {
                    console.log(err);
                  }
                );
              }
            }, function error(err) {
              console.log(err);
            });

       };

       (function(doc, script, domId){
         var js, fjs = doc.getElementsByTagName(script)[0];
         if (doc.getElementById(domId)) { return; }
         js = doc.createElement(script);
         js.id = domId;
         js.src = "//connect.facebook.com/en_US/messenger.Extensions.js";
         fjs.parentNode.insertBefore(js, fjs);
       }(document, 'script', 'Messenger'));

    </script>
  </body>
</html>
